{% parse_json object %}
{"stripe_signature":["t=1596728409","v1=93ad13b9cd8b421460c8fda33a2ee10b0d8ab32acb3ceeab5766f78589402151","v0=a388022530582a92268b09f34ba7f5183287d77db8cd29f1c3b383e8858c0583"],"post_params":{"id":"evt_1HCsAaKsARL4l4cv37XH7zzV","object":"event","account":"acct_1HCs92KsARL4l4cv","api_version":"2020-03-02","created":1596655260,"data":{"object":{"id":"acct_1HCs92KsARL4l4cv","object":"account","business_profile":{"mcc":"5734","name":null,"support_address":null,"support_email":null,"support_phone":"+48000000000","support_url":null,"url":null},"capabilities":{"card_payments":"active","transfers":"active"},"charges_enabled":true,"country":"PL","default_currency":"pln","details_submitted":true,"email":"piotr-seller7@near-me.com","payouts_enabled":false,"settings":{"branding":{"icon":null,"logo":null,"primary_color":null,"secondary_color":null},"card_payments":{"statement_descriptor_prefix":null,"decline_on":{"avs_failure":false,"cvc_failure":false}},"dashboard":{"display_name":null,"timezone":"Etc/UTC"},"payments":{"statement_descriptor":"","statement_descriptor_kana":null,"statement_descriptor_kanji":null},"bacs_debit_payments":{},"payouts":{"debit_negative_balances":true,"schedule":{"delay_days":7,"interval":"daily"},"statement_descriptor":null}},"type":"express","created":1596655236,"external_accounts":{"object":"list","data":[{"id":"ba_1HCs9kKsARL4l4cvj8S7ihzz","object":"bank_account","account":"acct_1HCs92KsARL4l4cv","account_holder_name":null,"account_holder_type":null,"bank_name":"STRIPE TEST BANK","country":"PL","currency":"pln","default_for_currency":true,"fingerprint":"HZN2r3tseo66ev2T","last4":"2874","metadata":{},"routing_number":"110000000","status":"new"}],"has_more":false,"total_count":1,"url":"/v1/accounts/acct_1HCs92KsARL4l4cv/external_accounts"},"login_links":{"object":"list","total_count":0,"has_more":false,"url":"/v1/accounts/acct_1HCs92KsARL4l4cv/login_links","data":[]},"metadata":{},"requirements":{"current_deadline":null,"currently_due":["individual.verification.additional_document","individual.verification.document"],"disabled_reason":"requirements.past_due","errors":[{"code":"verification_failed_keyed_identity","reason":"The identity information you entered cannot be verified. Please correct any errors or upload a document that matches the identity fields (e.g., name and date of birth) that you entered.","requirement":"individual.verification.additional_document"},{"code":"verification_failed_keyed_identity","reason":"The identity information you entered cannot be verified. Please correct any errors or upload a document that matches the identity fields (e.g., name and date of birth) that you entered.","requirement":"individual.verification.document"}],"eventually_due":["individual.verification.additional_document","individual.verification.document"],"past_due":["individual.verification.additional_document","individual.verification.document"],"pending_verification":[]}},"previous_attributes":{"requirements":{"currently_due":[],"disabled_reason":"requirements.pending_verification","errors":[],"eventually_due":[],"past_due":[],"pending_verification":["individual.verification.additional_document","individual.verification.document"]}}},"livemode":false,"pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"account.updated"}}
{% endparse_json %}

{% liquid
  function_rc object = 'modules/stripe/lib/webhooks/account_updated/validate', object: object

  comment
    TODO: stub webhook endpoint secret in database
  endcomment
  if object.errors.token[0] != 'secret not match'
    echo object
    include 'test/register_error', contract: contract, field_name: 'base', key: 'test.should.be_valid'
  endif
%}
